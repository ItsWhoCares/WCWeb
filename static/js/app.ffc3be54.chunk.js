(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{19:function(e,t){e.exports.myColors={pbgc:"black",sbgc:"black",secondaryText:"#707271",PrimaryMessage:"#f6c445",PrimaryMessagePressed:"#ffd859",SecondaryMessage:"#303134",SecondaryMessagePressed:"#444548",inputBox:"#303134",inputBoxText:"white",inputBoxInsideText:"#707271",primaryBtn:"#0095F6",primaryBtnPressed:"#4CB5F9",primaryBtnText:"white",primaryBtnTextPressed:"white",secondaryBtn:"#30475E",secondaryBtnPressed:"#303134",secondaryBtnText:"#0095F6",secondaryBtnTextPressed:"#0095F6",containerPressed:"#1e1e1e"}},319:function(e,t,r){"use strict";r.r(t);var n=r(106),o=r(11),a=r(159),i=r(102),s=r(160),l=r(0),c=r.n(l),d=r(7),u=r.n(d),f=r(14),h=r.n(f),g=r(9),m=r(112),b=r(524),y=r(523),j=r(22),p=r(52),x=r(40),O=(r(427),r(62)),v=r(19),C=r(68),w=(r(15),r(2)),S=o.default.create({container:{backgroundColor:v.myColors.inputBox,width:"100%",height:50,alignContent:"center",justifyContent:"center",paddingVertical:10,paddingHorizontal:20,marginVertical:5,marginBottom:10,borderRadius:5},container_error:{borderWidth:1,borderColor:"red"},text:{fontSize:15,color:v.myColors.inputBoxText,borderColor:v.myColors.inputBox}}),R=function(e){var t=e.control,r=e.name,n=e.secure,o=e.rules,a=void 0===o?{}:o,i=e.placeholder,s=e.autoFocus,l=void 0!==s&&s;return Object(w.jsx)(C.Controller,{control:t,name:r,render:function(e){var t=e.field,r=t.onChange,o=t.onBlur,a=t.value,s=e.fieldState.error;return Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(g.default,{style:[S.container,s?S.container_error:{}],children:Object(w.jsx)(O.default,{autoFocus:l,style:S.text,onBlur:o,onChangeText:r,value:a,placeholder:i,placeholderTextColor:v.myColors.inputBoxInsideText,secureTextEntry:n})}),s&&Object(w.jsx)(j.default,{style:{color:"red",alignSelf:"stretch"},children:s.message||"error"})]})},rules:a})},I=r(45),D=r(514),P=o.default.create({container_PRIMARY:{backgroundColor:v.myColors.primaryBtn,width:"100%",alignItems:"center",padding:15,marginVertical:5,borderRadius:5},container_pressed_PRIMARY:{backgroundColor:v.myColors.primaryBtnPressed,width:"100%",alignItems:"center",padding:15,marginVertical:5,borderRadius:5},container_SECONDARY:{backgroundColor:"#00000080",width:"100%",alignItems:"center",padding:15,marginVertical:5},container_pressed_SECONDARY:{backgroundColor:v.myColors.secondaryBtnPressed,width:"100%",alignItems:"center",padding:15,marginVertical:5,borderRadius:5},text_PRIMARY:{fontWeight:"bold",color:v.myColors.primaryBtnText,fontSize:15},text_pressed_PRIMARY:{fontWeight:"bold",color:v.myColors.primaryBtnTextPressed,fontSize:15},text_SECONDARY:{fontWeight:"bold",color:v.myColors.secondaryBtnText,fontSize:15},text_pressed_SECONDARY:{fontWeight:"bold",color:v.myColors.secondaryBtnTextPressed,fontSize:15}}),M=function(e){var t=e.onPress,r=e.text,n=e.type,o=void 0===n?"PRIMARY":n,a=e.bgC,i=e.fgC,s=e.icon,l=e.iconColor,c="";return s&&(c="    "),Object(w.jsx)(I.default,{onPress:t,style:function(e){return e.pressed?[P["container_pressed_"+o],a?{backgroundColor:a}:{}]:[P["container_"+o],a?{backgroundColor:a}:{}]},children:function(e){var t=e.pressed;return Object(w.jsxs)(j.default,{style:[t?[P["text_pressed_"+o],i?{color:i}:{}]:[P["text_"+o],i?{color:i}:{}]],children:[Object(w.jsx)(D.default,{name:s,size:24,color:l}),c,r]})}})},T=function(){console.warn("Sign in with Facebook")},U=function(){console.warn("Sign in with Google")},k=function(){return Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(M,{onPress:T,text:"Sign In with Facebook",bgC:"#E7EAF4",fgC:"#4765A9",icon:"facebook-f",iconColor:"#4765A9"}),Object(w.jsx)(M,{onPress:U,text:"Sign In with Google",bgC:"#e3e3e3",fgC:"#DD4D44",icon:"google",iconColor:"#DD4D44"})]})},L=r(51),z=r(286),E=r(58),B=Object(z.initializeApp)({apiKey:"AIzaSyDRv-P6nUYyq--NxBV9hW9SMTqsSygm61c",authDomain:"chatapp-4b244.firebaseapp.com",projectId:"chatapp-4b244",storageBucket:"chatapp-4b244.appspot.com",messagingSenderId:"503990776702",appId:"1:503990776702:web:6faf9c5de482da5fec392f",measurementId:"G-J530VKK9GF"}),A=Object(E.getAuth)(B),q=(r(433),r(323)),W=r(320),N=Object(W.createClient)("https://kllspqoqajlddmvgnsft.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtsbHNwcW9xYWpsZGRtdmduc2Z0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2NzE0NTc3OTcsImV4cCI6MTk4NzAzMzc5N30.-L9aJ-RjtphZTwzaR02m0JZOB-QsfxVYtm-G0HhavmA",{auth:{storage:q.default,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!1}}),V=function(){var e=u()((function*(e){var t=yield N.from("Message").select("*").eq("id",e),r=t.data,n=t.error;return n&&console.log(n),r[0]}));return function(t){return e.apply(this,arguments)}}(),_=r(515),F=r(140),H=function(){var e=u()((function*(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Hey there, I'am using WC.",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"https://notjustdev-dummy.s3.us-east-2.amazonaws.com/avatars/"+Math.floor(4*Math.random()+1)+".jpg";console.log(e);var o=yield N.from("User").select("*").eq("id",e),a=o.data,i=o.error;if(i)return console.log("first",i),!1;if(a.length>0)return!0;var s=yield N.from("User").insert([{id:e,name:t,status:r,image:n}]);return!s.error||(console.log("Second",s.error),!1)}));return function(t,r){return e.apply(this,arguments)}}(),Y=function(){var e=u()((function*(){var e=yield N.from("User").select("*"),t=e.data,r=e.error;return r?(console.log(r),[]):t}));return function(){return e.apply(this,arguments)}}(),J=function(){var e=u()((function*(e){var t=yield N.from("User").select("*").eq("id",e),r=t.data,n=t.error;return n?(console.log(n),null):r[0]}));return function(t){return e.apply(this,arguments)}}(),Z=function(){var e=u()((function*(e,t){var r=yield N.from("ChatRoom").insert([{LastMessageID:"b15f0db2-87f6-4358-874a-4297ee170240"}]).select(),n=r.data,o=r.error;if(o)return console.log(o),null;yield N.from("UserChatRoom").insert([{UserID:e,ChatRoomID:n[0].id},{UserID:t,ChatRoomID:n[0].id}]);return n[0]}));return function(t,r){return e.apply(this,arguments)}}(),G=function(){var e=u()((function*(e){var t=yield N.from("UserChatRoom").select("ChatRoomID").eq("UserID",e),r=t.data,n=t.error;if(n)return console.log(n),[];var o=yield N.from("UserChatRoom").select("User(*),ChatRoom(*)").in("ChatRoomID",r.map((function(e){return e.ChatRoomID}))),a=o.data,i=o.error;i&&console.log(i);var s=a.filter((function(t){return t.User.id!==e})),l=yield N.from("Message").select("*").in("id",s.map((function(e){return e.ChatRoom.LastMessageID}))),c=l.data,d=l.error;return d&&console.log(d),s.forEach((function(e){if(null!==e.ChatRoom.LastMessageID){var t=c.find((function(t){return t.id===e.ChatRoom.LastMessageID}));e.ChatRoom.LastMessage=t}else e.ChatRoom.LastMessage=null})),s}));return function(t){return e.apply(this,arguments)}}(),K=function(){var e=u()((function*(e){var t=yield N.from("ChatRoom").select("*, LastMessage:Message!ChatRoom_LastMessageID_fkey(created_at, text, UserID)[0]").eq("id",e),r=t.data,n=t.error;return n?(console.log(n),null):r[0]}));return function(t){return e.apply(this,arguments)}}(),X=function(){var e=u()((function*(e){var t=e.text,r=e.UserID,n=e.ChatRoomID,o=e.isMedia,a=void 0!==o&&o,i=e.ReplyMessageID,s=void 0===i?null:i,l=yield N.from("Message").insert([{text:t,UserID:r,ChatRoomID:n,isMedia:a,ReplyMessageID:s}]).select(),c=l.data,d=l.error;return d?(console.log(d),null):c[0]}));return function(t){return e.apply(this,arguments)}}(),Q=function(){var e=u()((function*(e){var t=e.id,r=e.isMedia;if(void 0!==r&&r){var n=yield N.from("Message").select("*").eq("id",t),o=n.data,a=n.error;if(a)return console.log(a),null;var i=yield N.storage.from("chatroom").remove([o[0].text]),s=(i.data,i.error);if(s)return console.log(s),null;var l=yield N.from("Message").update({text:"\u29b8  This message was deleted",isMedia:!1,ReplyMessageID:null}).eq("id",t).select(),c=l.data,d=l.error;return d?(console.log(d),null):c[0]}var u=yield N.from("Message").update({text:"\u29b8  This message was deleted",ReplyMessageID:null}).eq("id",t).select(),f=u.data,h=u.error;return h?(console.log(h),null):f[0]}));return function(t){return e.apply(this,arguments)}}(),$=function(){var e=u()((function*(e){var t=e.ChatRoomID,r=e.LastMessageID,n=yield N.from("ChatRoom").update({LastMessageID:r}).eq("id",t).select(),o=n.data,a=n.error;return a?(console.log(a),null):o[0]}));return function(t){return e.apply(this,arguments)}}(),ee=function(){var e=u()((function*(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){var r=yield N.from("Message").select("*, ReplyMessage:ReplyMessageID(*)").eq("ChatRoomID",e).order("created_at",{ascending:!1}),n=r.data,o=r.error;return o?(console.log(o),[]):n}var a=yield N.from("Message").select("*, ReplyMessage:ReplyMessageID(*)").eq("ChatRoomID",e).order("created_at",{ascending:!1}).limit(50),i=a.data,s=a.error;return s?(console.log(s),[]):i}));return function(t){return e.apply(this,arguments)}}(),te=(function(){var e=u()((function*(e){var t=yield N.from("User").select("ChatRoom(*)").eq("UserID",e),r=t.data,n=t.error;if(n)return console.log(n),[];console.log(r)}))}(),function(){var e=u()((function*(e){var t=e.authUserID,r=e.otherUserID,n=yield N.from("UserChatRoom").select("ChatRoomID").eq("UserID",r),o=n.data,a=n.error;if(a)return console.log(a),null;var i=yield N.from("UserChatRoom").select("ChatRoom(*)").eq("UserID",t).in("ChatRoomID",o.map((function(e){return e.ChatRoomID}))),s=i.data,l=i.error;return l?(console.log(l),null):0===s.length?null:s[0].ChatRoom}));return function(t){return e.apply(this,arguments)}}()),re=function(){var e=u()((function*(e){var t=e.UserID,r=void 0===t?A.currentUser.uid:t,n=e.PushToken,o=void 0===n?"":n;""===o&&F.isDevice&&(o=(yield _.default()).data);if(!F.isDevice)return null;var a=yield N.from("UserToken").select("*").eq("id",r),i=a.data,s=a.error;if(s)return console.log(s),null;if(0===i.length){var l=yield N.from("UserToken").insert([{id:r,PushToken:o}]),c=(l.data,l.error);return!c||(console.log(c),null)}var d=yield N.from("UserToken").update({PushToken:o}).eq("id",r),u=(d.data,d.error);return!u||(console.log(u),null)}));return function(t){return e.apply(this,arguments)}}(),ne=(function(){var e=u()((function*(e){var t=yield N.from("UserToken").select("*").eq("id",e),r=t.data,n=t.error;return n?(console.log(n),null):r[0]}))}(),function(){var e=u()((function*(e){var t=e.ChatRoomID,r=e.LastSeenMessageID,n=e.UserID,o=yield N.from("UserChatRoom").update({LastSeenMessageID:r,LastSeenAt:new Date}).eq("ChatRoomID",t).eq("UserID",n).select(),a=o.data,i=o.error;return i?(console.log(i),null):a[0]}));return function(t){return e.apply(this,arguments)}}()),oe=function(){var e=u()((function*(e){var t,r=e.ChatRoomID,n=e.UserID,o=yield N.from("UserChatRoom").select("*").eq("ChatRoomID",r).eq("UserID",n),a=o.data,i=o.error;return i?(console.log(i),null):null==(t=a[0])?void 0:t.LastSeenAt}));return function(t){return e.apply(this,arguments)}}(),ae=function(){var e=u()((function*(e){var t=e.ChatRoomID,r=e.UserID,n=yield N.from("UserChatRoom").update({LastSeenAt:new Date}).eq("ChatRoomID",t).eq("UserID",r).select(),o=n.data,a=n.error;return a?(console.log(a),null):o[0]}));return function(t){return e.apply(this,arguments)}}(),ie=(function(){var e=u()((function*(e){var t=yield N.from("UserChatRoom").select("ChatRoom(*)").eq("UserID",e),r=t.data,n=t.error;return n?(console.log(n),[]):(console.log(JSON.stringify(r[0],null,"\t")),r)}))}(),function(){var e=u()((function*(e){var t=yield N.from("Message").select("*, ReplyMessage:ReplyMessageID(*)").eq("id",e),r=t.data,n=t.error;return n?(console.log(n),null):r[0]}));return function(t){return e.apply(this,arguments)}}()),se=r(527),le=r(516),ce=r(517),de=r(21),ue=function(){var e=u()((function*(){if(F.isDevice){var e=(yield se.getPermissionsAsync()).status,t=e;if("granted"!==e)t=(yield se.requestPermissionsAsync()).status;if("granted"!==t)return void alert("Failed to get push token for push notification!");var r=(yield _.default()).data;console.log(r),yield re({UserID:A.currentUser.uid,PushToken:r})}"android"===de.default.OS&&le.default("default",{name:"default",importance:ce.AndroidImportance.MAX,vibrationPattern:[0,250,250,250],lightColor:"#FF231F7C"})}));return function(){return e.apply(this,arguments)}}(),fe=function(){var e=u()((function*(e){var t=e.UserID,r=e.message,n=yield N.from("UserToken").select("PushToken").eq("id",t),o=n.data,a=n.error;if(a)return console.log(a),null;if(0===o.length)return null;var i={to:o[0].PushToken,sound:"default",title:r.title,body:r.body,data:{data:"goes here"}};try{yield fetch("https://exp.host/--/api/v2/push/send",{mode:"no-cors",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})}catch(s){console.log("error")}}));return function(t){return e.apply(this,arguments)}}(),he=o.default.create({root:{backgroundColor:v.myColors.pbgc,alignItems:"center",padding:20},logo:{width:"100%",maxWidth:300,maxHeight:200},logoText:{paddingVertical:20,color:"white",fontSize:56},container:{maxWidth:400,width:"100%",borderColor:"white",borderWidth:1,borderRadius:10,marginVertical:20,padding:20,backgroundColor:v.myColors.sbgc},forgot:{fontWeight:"bold",paddingVertical:10,fontSize:15,color:"white",width:"100%",textAlign:"center"},social:{width:"100%",maxWidth:400},signup:{backgroundColor:v.myColors.pbgc,width:"100%",maxWidth:400}}),ge=function(){var e,t=Object(L.useRoute)(),r=Object(l.useState)(!1),n=h()(r,2),o=n[0],a=n[1],i=Object(C.useForm)({defaultValues:{email:null==t||null==(e=t.params)?void 0:e.email}}),s=i.control,c=i.handleSubmit,d=Object(L.useNavigation)(),f=function(){var e=u()((function*(e){if(!o){a(!0);try{var t=yield Object(E.signInWithEmailAndPassword)(A,e.email.trim(),e.password);if(!t.user.emailVerified)return void x.default.alert("Please verify your email");if(!(yield H(t.user.uid,t.user.displayName)))return void x.default.alert("Oops","Something went wrong");ue(),d.navigate("Home")}catch(r){x.default.alert("Oops",r.message)}finally{a(!1)}}}));return function(t){return e.apply(this,arguments)}}(),m=Object(l.useState)(""),b=h()(m,2),y=(b[0],b[1],Object(l.useState)("")),O=h()(y,2),S=(O[0],O[1],Object(p.default)());S.width,S.height;return Object(w.jsxs)(g.default,{style:he.root,children:[Object(w.jsx)(j.default,{style:he.logoText,children:"WhoCares!"}),Object(w.jsxs)(g.default,{style:he.container,children:[Object(w.jsx)(R,{autoFocus:!0,name:"email",placeholder:"Email",control:s,rules:{required:"Email is required"}}),Object(w.jsx)(R,{name:"password",placeholder:"Password",control:s,rules:{required:"Password is required",minLength:{value:6,message:"Password must be minimun 6 character long"}},secure:!0}),Object(w.jsx)(M,{onPress:c(f),text:o?"Loading...":"Sign In"}),Object(w.jsx)(j.default,{style:he.forgot,onPress:function(){d.navigate("ResetPassword")},children:"Forgot Password ?"})]}),Object(w.jsx)(g.default,{style:he.social,children:Object(w.jsx)(k,{})}),Object(w.jsx)(g.default,{style:he.signup,children:Object(w.jsxs)(j.default,{style:he.forgot,onPress:function(){console.warn("Sign up"),d.navigate("SignUp")},children:["Don't have an account?"," ",Object(w.jsx)(j.default,{style:{color:v.myColors.primaryBtn},children:"Sign Up"})]})})]})},me=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,be=function(){console.warn("Privacy")},ye=o.default.create({root:{backgroundColor:v.myColors.pbgc,alignItems:"center",padding:20},container:{maxWidth:400,width:"100%",borderColor:"white",borderWidth:1,borderRadius:10,marginVertical:20,padding:20,backgroundColor:v.myColors.sbgc},link:{fontWeight:"bold",paddingVertical:10,fontSize:15,color:"white",width:"100%",textAlign:"center"},title:{fontSize:24,fontWeight:"bold",color:"white",margin:10},text:{color:"#707271",fontSize:12,textAlign:"center",marginVertical:10}}),je=function(){var e=Object(l.useState)(!1),t=h()(e,2),r=t[0],n=t[1],o=Object(C.useForm)(),a=o.control,i=o.handleSubmit,s=(0,o.watch)("password"),c=Object(L.useNavigation)(),d=function(){var e=u()((function*(e){if(!r){n(!0);var t=e.name,o=e.email,a=e.password;t.trim(),o.trim(),a.trim();try{var i=yield Object(E.createUserWithEmailAndPassword)(A,o,a);yield Object(E.updateProfile)(i.user,{displayName:t,photoURL:"https://notjustdev-dummy.s3.us-east-2.amazonaws.com/avatars/"+Math.floor(4*Math.random()+1)+".jpg"});yield Object(E.sendEmailVerification)(i.user);x.default.alert("Success","Please check your email to confirm your account."),Object(E.signOut)(A),c.navigate("SignIn",{email:o})}catch(s){x.default.alert("Oops",s.message)}finally{n(!1)}}}));return function(t){return e.apply(this,arguments)}}(),f=Object(p.default)(),m=(f.width,f.height,Object(l.useState)("")),b=h()(m,2),y=(b[0],b[1],Object(l.useState)("")),O=h()(y,2),S=(O[0],O[1],Object(l.useState)("")),I=h()(S,2),D=(I[0],I[1],Object(l.useState)("")),P=h()(D,2);P[0],P[1];return Object(w.jsxs)(g.default,{style:ye.root,children:[Object(w.jsx)(j.default,{style:ye.title,children:"Create an account"}),Object(w.jsxs)(g.default,{style:ye.container,children:[Object(w.jsx)(R,{name:"name",placeholder:"Name",control:a,rules:{required:"Name is required",minLength:{value:3,message:"Name must be at least 3 characters"},maxLength:{value:15,message:"Name must be at most 15 characters"}}}),Object(w.jsx)(R,{name:"email",placeholder:"Email",control:a,rules:{required:"Email is required",pattern:{value:me,message:"Invalid email address"}}}),Object(w.jsx)(R,{name:"password",placeholder:"Password",control:a,rules:{required:"Password is required",minLength:{value:6,message:"Password must be at least 6 characters"}},secure:!0}),Object(w.jsx)(R,{name:"confirmPassword",placeholder:"Confirm Password",control:a,rules:{required:"Passwords do not match",validate:function(e){return e===s||"Passwords do not match"}},secure:!0}),Object(w.jsx)(M,{onPress:i(d),text:r?"Loading...":"Register"}),Object(w.jsxs)(j.default,{style:ye.text,children:["By registering, you confirm that you accept our"," ",Object(w.jsx)(j.default,{style:{color:"white"},onPress:function(){c.navigate("ConfirmEmail"),console.warn("Terms")},children:"Terms of use"})," ","and"," ",Object(w.jsx)(j.default,{style:{color:"white"},onPress:be,children:"Privacy Policy"})]})]}),Object(w.jsx)(g.default,{style:{maxWidth:400,width:"100%"},children:Object(w.jsx)(k,{})}),Object(w.jsxs)(j.default,{style:ye.link,onPress:function(){console.warn("Sign in"),c.navigate("SignIn")},children:["Already have an account?"," ",Object(w.jsx)(j.default,{style:{color:v.myColors.primaryBtn},children:"Sign In"})]})]})},pe=o.default.create({root:{flex:1,backgroundColor:v.myColors.pbgc,alignItems:"center",padding:20},container:{width:"100%",borderColor:"white",borderWidth:1,borderRadius:10,marginVertical:20,padding:20,backgroundColor:v.myColors.sbgc},link:{fontWeight:"bold",paddingVertical:10,fontSize:15,color:"white",width:"100%",textAlign:"center",textDecorationLine:"underline",textDecorationColor:"white"},title:{fontSize:24,fontWeight:"bold",color:"white",margin:10},text:{width:"100%",color:"#707271",fontSize:12,marginVertical:10},btnContainer:{flexDirection:"row",justifyContent:"space-between"}}),xe=function(){var e,t=Object(L.useRoute)(),r=Object(C.useForm)({defaultValues:{email:null==t||null==(e=t.params)?void 0:e.email}}),n=r.control,o=r.handleSubmit,a=(0,r.watch)("email"),i=Object(L.useNavigation)(),s=function(){var e=u()((function*(e){try{yield Auth.confirmSignUp(e.email,e.code);i.popToTop()}catch(t){x.default.alert("Oops",t.message)}}));return function(t){return e.apply(this,arguments)}}(),c=function(){var e=u()((function*(){try{yield Auth.resendSignUp(a);x.default.alert("Success","Code resent")}catch(e){x.default.alert("Oops",e.message)}}));return function(){return e.apply(this,arguments)}}(),d=Object(p.default)(),f=(d.width,d.height,Object(l.useState)("")),m=h()(f,2),b=(m[0],m[1],Object(l.useState)("")),y=h()(b,2);y[0],y[1];return Object(w.jsxs)(g.default,{style:pe.root,children:[Object(w.jsx)(j.default,{style:pe.title,children:"Confirm your email"}),Object(w.jsxs)(g.default,{style:pe.container,children:[Object(w.jsx)(R,{name:"email",placeholder:"Email",control:n,rules:{required:"Email is required"}}),Object(w.jsx)(R,{name:"code",placeholder:"Enter your confirmation code",control:n,rules:{required:"Confirmation code is required"}}),Object(w.jsx)(M,{onPress:o(s),text:"Confirm"}),Object(w.jsxs)(g.default,{style:pe.btnContainer,children:[Object(w.jsx)(g.default,{children:Object(w.jsx)(M,{text:"Resend code",type:"SECONDARY",onPress:c})}),Object(w.jsx)(g.default,{children:Object(w.jsx)(M,{text:"Back to Sign in",onPress:function(){console.warn("Sign in"),i.navigate("SignIn")},type:"SECONDARY"})})]})]})]})},Oe=r(20),ve=r.n(Oe),Ce=r(66),we=r(60),Se=r(110),Re=r(103),Ie=r(6),De=r.n(Ie),Pe=r(38),Me=r(55),Te=r.n(Me),Ue=r(81),ke=r.n(Ue);function Le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}Te.a.extend(ke.a);var ze=o.default.create({container:{flexDirection:"row",marginHorizontal:10,marginVertical:5,height:80,borderRadius:10,padding:5},containerPressed:{backgroundColor:v.myColors.containerPressed,flexDirection:"row",marginHorizontal:10,marginVertical:5,borderRadius:10,height:80,padding:5},content:{flex:1,borderBottomWidth:o.default.hairlineWidth,borderBottomColor:"grey"},image:{width:60,height:60,borderRadius:30,marginRight:10,marginVertical:5},row:{flexDirection:"row",marginBottom:5},name:{fontSize:16,color:"white",flex:1},time:{color:v.myColors.secondaryText,paddingHorizontal:5},text:{color:v.myColors.secondaryText}}),Ee=function(e){var t,r,n,o,a=e.chat,i=e.onPress,s=(Object(L.useNavigation)(),Object(l.useState)(a.User)),c=h()(s,2),d=c[0],f=(c[1],Object(l.useState)(a)),m=h()(f,2),b=m[0],y=m[1];return Object(l.useEffect)((function(){(function(){var e=u()((function*(){}));return function(){return e.apply(this,arguments)}})()();var e=N.channel("public:ChatRoom:id=eq."+a.ChatRoom.id).on("postgres_changes",{event:"UPDATE",schema:"public",table:"ChatRoom",filter:"id=eq."+a.ChatRoom.id},function(){var e=u()((function*(e){if(e.new.id===b.ChatRoom.id){var t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Le(Object(r),!0).forEach((function(t){De()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Le(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},b)||{};t.ChatRoom.LastMessageID=e.new.LastMessageID;var r=yield V(e.new.LastMessageID);t.ChatRoom.LastMessage=r,y(t)}}));return function(t){return e.apply(this,arguments)}}()).subscribe();return function(){return N.removeChannel(e)}}),[a.ChatRoom.id]),"Send first message"==(null==b||null==(t=b.ChatRoom)?void 0:t.LastMessage.text)?null:Object(w.jsxs)(I.default,{style:function(e){return e.pressed?[ze.containerPressed]:ze.container},onPress:function(){var e;return i({id:d.id,name:d.name,image:d.image},null==b||null==(e=b.ChatRoom)?void 0:e.id)},children:[Object(w.jsx)(Pe.default,{style:ze.image,source:{uri:null==d?void 0:d.image}}),Object(w.jsxs)(g.default,{style:ze.content,children:[Object(w.jsxs)(g.default,{style:ze.row,children:[Object(w.jsx)(j.default,{numberOfLines:1,style:ze.name,children:null==d?void 0:d.name}),(null==b?void 0:b.ChatRoom.LastMessage)&&Object(w.jsx)(j.default,{numberOfLines:2,style:ze.time,children:Te()(null==b||null==(r=b.ChatRoom)||null==(n=r.LastMessage)?void 0:n.created_at).fromNow(!0)})]}),Object(w.jsx)(j.default,{style:ze.text,numberOfLines:2,children:null==b||null==(o=b.ChatRoom.LastMessage)?void 0:o.text})]})]})},Be=r(518),Ae=o.default.create({root:{flexDirection:"row",alignItems:"center",justifyContent:"center",paddingVertical:10},left:{paddingHorizontal:20},title:{color:"white",fontSize:20},right:{marginLeft:"auto",flexDirection:"row",paddingHorizontal:20}}),qe=function(){var e=Object(L.useNavigation)(),t=function(){var t=u()((function*(){e.navigate("Settings")}));return function(){return t.apply(this,arguments)}}();return Object(w.jsxs)(g.default,{style:Ae.root,children:[Object(w.jsx)(g.default,{style:Ae.left,children:Object(w.jsx)(j.default,{style:Ae.title,children:"Chats"})}),Object(w.jsxs)(g.default,{style:Ae.right,children:[Object(w.jsx)(Be.default,{onPress:function(){e.navigate("Search")},name:"search1",size:24,color:"white",style:{marginRight:20}}),Object(w.jsx)(Be.default,{onPress:t,name:"setting",size:24,color:"white",style:{}})]})]})},We=r(291),Ne=r(521);Te.a.extend(ke.a);var Ve=o.default.create({container:{flexDirection:"row",marginHorizontal:10,marginVertical:5,height:70},content:{flex:1,borderBottomWidth:o.default.hairlineWidth,borderBottomColor:"grey"},image:{width:60,height:60,borderRadius:30,marginRight:10},row:{flexDirection:"row",marginBottom:5},name:{fontSize:16,color:"white",flex:1},subTitle:{color:v.myColors.secondaryText}}),_e=function(e){var t=e.user,r=Object(L.useNavigation)(),n=Object(l.useState)(null),o=h()(n,2),a=o[0],i=o[1],s=Object(l.useState)(!1),c=h()(s,2),d=c[0],f=c[1];Object(l.useEffect)((function(){(function(){var e=u()((function*(){var e=A.currentUser;i(e)}));return function(){return e.apply(this,arguments)}})()()}),[]);var m=function(){var e=u()((function*(){if(!d){f(!0);var e=yield te({authUserID:A.currentUser.uid,otherUserID:t.id});if(console.log("other user",t.id,"auth user",A.currentUser.uid),console.log("here",e),e)r.navigate("ChatRoom",{id:e.id,user:{id:t.id,name:t.name,image:t.image}});else{var n=yield Z(A.currentUser.uid,t.id);console.log(n),r.navigate("ChatRoom",{id:n.id,user:{id:t.id,name:t.name,image:t.image}}),f(!1)}}}));return function(){return e.apply(this,arguments)}}();return(null==a?void 0:a.uid)==t.id?null:Object(w.jsxs)(I.default,{style:Ve.container,onPress:m,children:[Object(w.jsx)(Pe.default,{style:Ve.image,source:{uri:t.image}}),Object(w.jsxs)(g.default,{style:Ve.content,children:[Object(w.jsxs)(g.default,{style:Ve.row,children:[Object(w.jsx)(j.default,{numberOfLines:1,style:Ve.name,children:t.name}),void 0!==t.createdAt&&Object(w.jsx)(j.default,{numberOfLines:2,style:Ve.subTitle,children:Te()(t.createdAt).fromNow(!0)})]}),void 0!==t.status&&Object(w.jsx)(j.default,{numberOfLines:2,style:Ve.subTitle,children:t.status})]})]})},Fe=r(520),He=r(296),Ye=r(325),Je=r(73),Ze=o.default.create({inputContainer:{flexDirection:"row",backgroundColor:v.myColors.SecondaryMessage,borderRadius:25,justifyContent:"space-between",alignItems:"center",paddingHorizontal:8,paddingVertical:4,marginHorizontal:15,marginBottom:10},input:{flex:1,height:40,backgroundColor:v.myColors.SecondaryMessage,borderColor:v.myColors.SecondaryMessage,borderWidth:1,paddingHorizontal:10,marginRight:8,borderRadius:20,color:"white",alignContent:"center",justifyContent:"center",paddingTop:10},button:{width:80},replyContainer:{flexDirection:"row",borderTopWidth:o.default.hairlineWidth,borderColor:v.myColors.secondaryText,padding:10,paddingLeft:15},reply:{fontSize:12,color:v.myColors.secondaryText},iconClose:{marginLeft:"auto",justifyContent:"center",alignContent:"center",padding:8,borderRadius:24}}),Ge=function(){var e=u()((function*(e,t,r){var n=e.uri.substring(e.uri.lastIndexOf(".")+1);if(console.log(n),"png"==n||"jpg"==n||"jpeg"==n){var o=e.base64,a=Object(He.decode)(o),i=e.uri.substring(e.uri.lastIndexOf("/")+1),s=yield N.storage.from("chatroom").upload(t+"/"+i,a,{contentType:"image/"+n}),l=s.data,c=s.error;if(c)return console.log(c),void x.default.alert("Error","Error uploading image");console.log(e.uri.substring(e.uri.lastIndexOf("/")+1)),console.log(l);yield X({ChatRoomID:t,text:l.path,UserID:A.currentUser.uid,isMedia:!0});var d={title:(yield J(A.currentUser.uid)).name,body:"Image"};fe({UserID:r,message:d})}else x.default.alert("Error","Only png, jpg, and jpeg are supported")}));return function(t,r,n){return e.apply(this,arguments)}}(),Ke=function(e){var t=e.chatRoom,r=e.otherUser,n=e.onTyping,o=e.replying,a=e.handleReplyingCancel,i=Object(l.useState)(""),s=h()(i,2),c=s[0],d=s[1],f=Object(l.useState)(!1),m=h()(f,2),b=m[0],y=m[1],p=function(){var e=u()((function*(){if(!b&&(y(!0),""!==c)){var e=yield X({ChatRoomID:t.id,text:c.trim(),UserID:A.currentUser.uid,ReplyMessageID:null==o?void 0:o.id});d(""),a();yield $({ChatRoomID:t.id,LastMessageID:e.id});y(!1);var n={title:(yield J(A.currentUser.uid)).name,body:e.text};fe({UserID:r.id,message:n})}}));return function(){return e.apply(this,arguments)}}(),x=function(){var e=u()((function*(){if("web"!==de.default.OS){var e=yield Ye.launchImageLibraryAsync({mediaTypes:Je.MediaTypeOptions.All,allowsEditing:!0,aspect:[4,3],quality:1,base64:!0});e.canceled||Ge(e.assets[0],t.id,r.id)}}));return function(){return e.apply(this,arguments)}}();return Object(w.jsxs)(w.Fragment,{children:[o&&Object(w.jsxs)(g.default,{style:Ze.replyContainer,children:[Object(w.jsxs)(g.default,{children:[Object(w.jsx)(j.default,{style:Ze.reply,children:"Replying to "+(null==r?void 0:r.name)}),Object(w.jsx)(j.default,{style:{color:"white",fontSize:12},children:null==o?void 0:o.text})]}),Object(w.jsx)(g.default,{style:Ze.iconClose,children:Object(w.jsx)(Be.default,{name:"close",size:24,color:"white",onPress:function(){return a()}})})]}),Object(w.jsxs)(g.default,{style:Ze.inputContainer,children:[Object(w.jsx)(Be.default,{name:"plus",size:24,color:"white",onPress:x}),Object(w.jsx)(O.default,{value:c,onChangeText:function(e){d(e),n(e)},placeholder:"Message...",placeholderTextColor:"gray",style:[Ze.input,{height:Math.max(40,Math.min(1.5*c.split(/\r\n|\r|\n/).length+40,60))}],returnKeyType:"send",onSubmitEditing:p,multiline:!0}),Object(w.jsx)(Fe.default,{onPress:p,name:"send",size:24,color:"royalblue"})]})]})},Xe=o.default.create({root:{flex:1,backgroundColor:v.myColors.pbgc,paddingVertical:10,justifyContent:"center"},inputContainer:{flex:1},input:{height:40,width:"80%",backgroundColor:v.myColors.SecondaryMessage,borderColor:v.myColors.SecondaryMessage,borderWidth:1,paddingHorizontal:20,marginLeft:15,borderRadius:20,color:"white"}}),Qe=function(){var e=Object(L.useNavigation)(),t=c.a.useState(""),r=h()(t,2),n=(r[0],r[1],c.a.useState([])),o=h()(n,2),a=o[0],i=o[1],s=c.a.useState(!1),d=h()(s,2),f=d[0],m=d[1],b=function(){var e=u()((function*(){m(!0);try{var e=yield Y();i(e)}catch(t){console.log(t)}finally{m(!1)}}));return function(){return e.apply(this,arguments)}}();return Object(l.useLayoutEffect)((function(){e.setOptions({headerShown:!0,headerTitle:"",headerStyle:{backgroundColor:v.myColors.pbgc},headerLeft:function(){return Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(Be.default,{onPress:e.goBack,name:"arrowleft",size:24,color:"white"}),Object(w.jsx)(g.default,{style:Xe.inputContainer,children:Object(w.jsx)(O.default,{onChangeText:function(e){return function(e){if(console.log(e),0!==e.length){var t=a.filter((function(t){return t.name.toLowerCase().includes(e.toLowerCase())}));console.log(a),console.log(JSON.stringify(t,null,"\t")),i([]),i(t)}else b()}(e)},placeholder:"Search...",placeholderTextColor:"gray",style:Xe.input})})]})}})}),[a]),Object(l.useEffect)((function(){b(),console.log("fetching users")}),[]),Object(w.jsx)(g.default,{style:Xe.root,children:Object(w.jsx)(we.default,{data:a,renderItem:function(e){var t=e.item;return Object(w.jsx)(_e,{user:t})},onRefresh:b,refreshing:f})})};Te.a.extend(ke.a);var $e=o.default.create({root:{margin:5,borderRadius:10,maxWidth:"80%",minWidth:"20%",shadowColor:"#fff",shadowOffset:{width:0,height:1},shadowOpacity:.18,shadowRadius:1,elevation:1},text:{paddingTop:10,paddingHorizontal:10,color:"white"},time:{paddingBottom:5,paddingRight:10,fontSize:10,color:v.myColors.secondaryText,alignSelf:"flex-end"},SwipeTime:{paddingTop:5,color:v.myColors.secondaryText,fontSize:12,alignSelf:"center"},myMsg:{backgroundColor:v.myColors.PrimaryMessage,alignSelf:"flex-end",borderBottomRightRadius:2,borderBottomLeftRadius:10},myMsgPressed:{backgroundColor:v.myColors.PrimaryMessagePressed,alignSelf:"flex-end",borderBottomRightRadius:2,borderBottomLeftRadius:10},otherMsg:{backgroundColor:v.myColors.SecondaryMessage,alignSelf:"flex-start",borderBottomRightRadius:10,borderBottomLeftRadius:2},otherMsgPressed:{backgroundColor:v.myColors.SecondaryMessagePressed,alignSelf:"flex-start",borderBottomRightRadius:10,borderBottomLeftRadius:2},myReplyMsgContainer:{maxWidth:"80%",minWidth:"20%",alignSelf:"flex-end"},otherReplyMsgContainer:{maxWidth:"80%",minWidth:"20%",alignSelf:"flex-start"},myReplyMsg:{backgroundColor:v.myColors.PrimaryMessage,alignSelf:"flex-end",borderRadius:20,opacity:.8,minWidth:"10%"},otherReplyMsg:{backgroundColor:v.myColors.SecondaryMessage,alignSelf:"flex-start",borderRadius:20,minWidth:"10%",opacity:.8},replyMsgText:{color:v.myColors.secondaryText,fontSize:12,padding:5},replyText:{color:"white",fontSize:14,padding:10}}),et=Object(l.memo)((function(e){var t=e.message,r=e.authUser,o=e.handleReplying,a=Object(l.useState)(!1),i=h()(a,2),s=i[0],c=i[1],d=Object(l.useRef)(null),u=Object(p.default)(),f=(u.height,u.width),m=(null==t?void 0:t.UserID)===r,b=function(){return 1==(null==t?void 0:t.isMedia)},y=function(){0!=m&&"\u29b8  This message was deleted"!=t.text&&x.default.alert("Delete Message","Are you sure you want to delete this message?",[{text:"Cancel",onPress:function(){return console.log("Cancel Pressed")},style:"cancel"},{text:"OK",onPress:function(){Q({id:t.id})?console.log("Message deleted successfully"):console.log("Message deletion failed"),t.text="\u29b8  This message was deleted",t.ReplyMessageID=null,c(!s)}}],{cancelable:!0})},O=function(){var e;null==d||null==(e=d.current)||e.close(),b()||o(t)},C=function(){return Object(w.jsx)(g.default,{style:{backgroundColor:v.myColors.pbgc,width:"10%",height:"100%",justifyContent:"center",alignItems:"center"},children:Object(w.jsx)(j.default,{style:$e.SwipeTime,children:Te()(t.created_at).format("DD MMM YY")})})};if(b())return Object(w.jsx)(n.Swipeable,{ref:d,renderRightActions:m?C:null,renderLeftActions:m?null:C,overshootFriction:10,onSwipeableWillOpen:O,children:Object(w.jsxs)(I.default,{onPress:function(){},onLongPress:function(){0!=m&&"\u29b8  This message was deleted"!=t.text&&x.default.alert("Delete Message","Are you sure you want to delete this message?",[{text:"Cancel",onPress:function(){return console.log("Cancel Pressed")},style:"cancel"},{text:"OK",onPress:function(){Q({id:t.id,isMedia:!0})?console.log("Message deleted successfully"):console.log("Message deletion failed"),t.text="\u29b8  This message was deleted",t.isMedia=!1,console.log(t),c(!s)}}],{cancelable:!0})},style:function(e){return e.pressed?[$e.root,{padding:5,backgroundColor:m?v.myColors.PrimaryMessagePressed:v.myColors.SecondaryMessagePressed,alignSelf:m?"flex-end":"flex-start",borderBottomRightRadius:m?2:10,borderBottomLeftRadius:m?10:2}]:[$e.root,{padding:5,backgroundColor:m?v.myColors.PrimaryMessage:v.myColors.SecondaryMessage,alignSelf:m?"flex-end":"flex-start",borderBottomRightRadius:m?2:10,borderBottomLeftRadius:m?10:2}]},children:[Object(w.jsx)(Pe.default,{progressiveRenderingEnabled:!0,resizeMethod:"scale",style:{width:.7*f,height:200,borderRadius:10},source:{uri:N.storage.from("chatroom").getPublicUrl(t.text).data.publicUrl}}),Object(w.jsx)(j.default,{style:[$e.time,{paddingTop:5,paddingBottom:0}],children:Te()(t.created_at).format("hh:mm a")})]})});if(t.ReplyMessageID){var S,R,D=(null==t||null==(S=t.ReplyMessage)?void 0:S.UserID)===r,P=D?m?"Replied to yourself":"Replied to you":m?"You replied":"Replied to themself";return Object(w.jsxs)(n.Swipeable,{ref:d,renderRightActions:m?C:null,renderLeftActions:m?null:C,overshootLeft:!1,overshootRight:!1,overshootFriction:10,onSwipeableWillOpen:O,children:[Object(w.jsxs)(g.default,{style:m?{alignSelf:"flex-end"}:{alignSelf:"flex-start"},children:[Object(w.jsx)(j.default,{style:[$e.replyMsgText,m?{marginLeft:"auto"}:null],children:P}),Object(w.jsxs)(g.default,{style:m?{flexDirection:"row-reverse"}:{flexDirection:"row"},children:[Object(w.jsx)(g.default,{style:{flexDirection:"row",backgroundColor:v.myColors.SecondaryMessage,width:2,marginRight:m?5:10,marginLeft:m?10:5,borderRadius:10},children:Object(w.jsx)(j.default,{children:" "})}),Object(w.jsx)(I.default,{style:D?m?$e.myReplyMsg:[$e.myReplyMsg,{alignSelf:"flex-start"}]:$e.otherReplyMsg,children:Object(w.jsx)(j.default,{style:$e.replyText,children:null==t||null==(R=t.ReplyMessage)?void 0:R.text})})]})]}),Object(w.jsxs)(I.default,{onLongPress:y,style:function(e){return e.pressed?[$e.root,m?$e.myMsgPressed:$e.otherMsgPressed]:[$e.root,m?$e.myMsg:$e.otherMsg]},children:[Object(w.jsx)(j.default,{style:$e.text,children:t.text}),Object(w.jsx)(j.default,{style:$e.time,children:Te()(t.created_at).format("hh:mm a")})]})]})}return Object(w.jsx)(n.Swipeable,{ref:d,renderRightActions:m?C:null,renderLeftActions:m?null:C,overshootFriction:10,overshootLeft:!1,overshootRight:!1,onSwipeableWillOpen:O,children:Object(w.jsxs)(I.default,{onLongPress:y,style:function(e){return e.pressed?[$e.root,m?$e.myMsgPressed:$e.otherMsgPressed]:[$e.root,m?$e.myMsg:$e.otherMsg]},children:[Object(w.jsx)(j.default,{style:$e.text,children:t.text}),Object(w.jsx)(j.default,{style:$e.time,children:Te()(t.created_at).format("hh:mm a")})]})})}));Te.a.extend(ke.a);var tt=o.default.create({root:{flexDirection:"column"},online:{color:v.myColors.PrimaryMessage,fontSize:10,fontWeight:"bold"},lastSeen:{color:"white",fontSize:10}}),rt=function(e){var t,r=e.image,n=e.oUser,o=(e.getTypingMessage,"usOWdwZr9XeOwdkIyjbJixXDmC12"===A.currentUser.uid),a=(Object(L.useNavigation)(),c.a.useState(void 0)),i=h()(a,2),s=i[0],l=i[1],d=c.a.useState(n),f=h()(d,2),m=f[0],b=(f[1],c.a.useState(null)),y=h()(b,2),p=y[0],x=y[1],O=c.a.useState(null),v=h()(O,2),C=v[0],S=v[1],R=c.a.useState(!1),I=h()(R,2),D=I[0],P=I[1],M=c.a.useState(null),T=h()(M,2),U=T[0],k=T[1],z=function(){var e=u()((function*(e){if(!C){var t=yield te({authUserID:A.currentUser.uid,otherUserID:m.id});S(t)}if(C){var r=yield oe({UserID:m.id,ChatRoomID:null==C?void 0:C.id});x(r),ae({UserID:A.currentUser.uid,ChatRoomID:null==C?void 0:C.id})}}));return function(t){return e.apply(this,arguments)}}();c.a.useEffect((function(){z("effetc")}),[C]),c.a.useEffect((function(){var e,t=N.channel("online-users",{config:{presence:{key:A.currentUser.uid}}});return t.on("presence",{event:"sync"},u()((function*(){var e=t.presenceState(),r=m.id;if(e[r]){var n=e[r][0];l(!!(e.hasOwnProperty(m.id)&&(new Date).getTime()-n.online_at<1e4))}else l(!1),z()}))),t.subscribe(function(){var r=u()((function*(r){"SUBSCRIBED"===r&&(e=setInterval(u()((function*(){yield t.track({online_at:(new Date).getTime()})})),5e3))}));return function(e){return r.apply(this,arguments)}}()),function(){clearInterval(e),N.removeChannel(t)}}),[n]);return c.a.useEffect((function(){C&&N.channel(C.id).on("broadcast",{event:"TYPING"},(function(e){var r;console.log(A.currentUser.uid,e.payload),e.payload.userID==n.id&&(r=e.payload,t&&clearTimeout(t),console.log(r),r&&(P(!0),k(r.msg),t=setTimeout((function(){P(!1),k(null)}),4e3)))}))}),[C]),Object(w.jsxs)(g.default,{style:{flexDirection:"row"},children:[Object(w.jsx)(g.default,{style:{flexDirection:"row"},children:Object(w.jsx)(Pe.default,{source:{uri:r},style:{width:40,height:40,borderRadius:20,marginLeft:15,marginRight:15}})}),Object(w.jsxs)(g.default,{style:tt.root,children:[Object(w.jsx)(j.default,{style:{color:"white",fontWeight:"bold",fontSize:20},children:m.name}),s?D?o?Object(w.jsx)(j.default,{numberOfLines:1,style:tt.online,children:"Typing: "+U}):Object(w.jsx)(j.default,{style:tt.online,children:"Typing..."}):Object(w.jsx)(j.default,{style:tt.online,children:"Online"}):p&&Object(w.jsx)(j.default,{style:tt.lastSeen,children:"Last seen "+Te()(p).fromNow()})]})]})},nt=r(301);Te.a.extend(ke.a);var ot=o.default.create({root:{flex:1,backgroundColor:v.myColors.pbgc},list:{flex:1,paddingHorizontal:10},header:{marginBottom:10}}),at=function(e){var t=e.otherUser,r=e.chatRoomId,n=(Object(L.useRoute)(),Object(L.useNavigation)()),o=Object(l.useState)(null),a=h()(o,2),i=a[0],s=a[1],c=Object(l.useState)(A.currentUser),d=h()(c,2),f=d[0],b=d[1],y=Object(l.useState)([]),j=h()(y,2),x=j[0],O=j[1],C=Object(l.useState)(!1),S=h()(C,2),R=S[0],I=S[1],D=Object(l.useState)(null),P=h()(D,2),M=P[0],T=P[1];Object(l.useEffect)((function(){b(A.currentUser)}),[i]);var U=Object(p.default)(),k=(U.width,U.height,Object(l.useState)(!1)),z=h()(k,2);z[0],z[1];Object(l.useEffect)((function(){K(r).then((function(e){return s(e)}))}),[r]),Object(l.useEffect)((function(){return function(){console.log("Cleared interval")}}),[]);var E=function(){var e=u()((function*(){I(!0);try{var e=yield ee(r,!0);O(e);var n=e.find((function(e){return e.UserID===(null==t?void 0:t.id)}));ne({ChatRoomID:r,UserID:A.currentUser.uid,LastSeenMessageID:n.id})}catch(o){console.log(o)}finally{I(!1)}}));return function(){return e.apply(this,arguments)}}();Object(l.useEffect)((function(){E();var e=N.channel("public:Message:ChatRoomID=eq."+r).on("postgres_changes",{event:"INSERT",schema:"public",table:"Message",filter:"ChatRoomID=eq."+r},function(){var e=u()((function*(e){var t=yield ie(e.new.id);O((function(e){return[t].concat(ve()(e))}))}));return function(t){return e.apply(this,arguments)}}()).on("postgres_changes",{event:"UPDATE",schema:"public",table:"Message",filter:"ChatRoomID=eq."+r},function(){var e=u()((function*(e){O((function(t){var r=t.findIndex((function(t){return t.id===e.new.id}));if(r>=0){var n=ve()(t);return n[r]=e.new,n}return t}))}));return function(t){return e.apply(this,arguments)}}()).subscribe();return function(){N.removeChannel(e),N.removeAllChannels(),console.log("Removed subscription")}}),[r]);var B=Object(l.useRef)(null),q=Object(l.useState)(""),W=h()(q,2),V=W[0],_=W[1];Object(l.useEffect)((function(){var e=N.channel(r);return e.subscribe(function(){var t=u()((function*(t){if("SUBSCRIBED"===t){var r=yield e.send({type:"broadcast",event:"TYPING",payload:{userID:A.currentUser.uid,msg:V}});console.log(r)}}));return function(e){return t.apply(this,arguments)}}()),function(){N.removeChannel(e)}}),[r,V]);var F=function(e){"active"===e&&E()};Object(l.useEffect)((function(){var e=Re.default.addEventListener("change",F);return function(){return e.remove()}}),[]);var H=Object(l.useCallback)((function(e){T(e),console.log(e)})),Y=Object(l.useCallback)((function(){return null==B?void 0:B.current}),[r]);if(Object(l.useEffect)((function(){n.setOptions({title:null,headerStyle:{backgroundColor:v.myColors.pbgc},headerLeft:function(){return Object(w.jsx)(rt,{getTypingMessage:Y,image:null==t?void 0:t.image,oUser:t})}})}),[t.name]),!i)return console.table({otherUser:t,chatRoomId:r}),Object(w.jsx)(g.default,{style:ot.root,children:Object(w.jsx)(m.default,{})});return Object(w.jsxs)(g.default,{style:ot.root,children:[Object(w.jsx)(g.default,{style:ot.header,children:Object(w.jsx)(rt,{getTypingMessage:Y,image:null==t?void 0:t.image,oUser:t})}),Object(w.jsx)(g.default,{style:ot.list,children:Object(w.jsx)(nt.FlashList,{showsVerticalScrollIndicator:!1,data:x,renderItem:function(e){var t=e.item;return Object(w.jsx)(et,{message:t,authUser:f.uid,handleReplying:H})},inverted:!0,onRefresh:E,refreshing:R,estimatedItemSize:100,drawDistance:200})}),Object(w.jsx)(g.default,{style:{paddingTop:10},children:Object(w.jsx)(Ke,{chatRoom:i,otherUser:t,onTyping:function(e){_(e)},replying:M,handleReplyingCancel:function(){T(null)}})})]})},it=o.default.create({root:{flexDirection:"row",backgroundColor:v.myColors.pbgc,paddingVertical:5,justifyContent:"center",alignItems:"center",paddingHorizontal:15},emptyChats:{flex:1,backgroundColor:v.myColors.pbgc,width:"100%",justifyContent:"center",alignItems:"center"},noChat:{color:"white",fontSize:20,textAlign:"center"},homeleft:{height:"100%"},homeleftHeader:{height:50},noChatRoom:{height:"100%",alignContent:"center",justifyContent:"center"},chatRoom:{height:"100%"}}),st=function(){var e,t,r=Object(p.default)(),n=r.width,o=r.height,a=Object(l.useState)(""),i=h()(a,2);i[0],i[1];Object(l.useEffect)((function(){var e=We.addPushTokenListener(re);return function(){return e.remove()}}),[]);var s=Object(l.useRef)(Re.default.currentState),d=function(e){s.current.match(/inactive|background/)&&"active"===e&&(console.log("App has come to the foreground!"),z(!k),Ne.default()),s.current,s.current=e};Object(l.useEffect)((function(){Re.default.addEventListener("change",d)}),[]);var f=Object(L.useNavigation)(),m=Object(l.useState)(null),b=h()(m,2),y=b[0],x=b[1],O=c.a.useState([]),C=h()(O,2),S=C[0],R=C[1],I=c.a.useState(!1),D=h()(I,2),P=D[0],M=D[1],T=c.a.useState(!1),U=h()(T,2),k=U[0],z=U[1];Object(l.useEffect)((function(){f.setOptions({headerShown:!0,title:"Chats",headerStyle:{backgroundColor:v.myColors.pbgc},headerTintColor:"white",headerTitleAlign:"left",headerRight:function(){return Object(w.jsx)(qe,{})}})}),[]);var E=function(){var e=u()((function*(){z(!k),M(!0);var e=(yield G(A.currentUser.uid)).sort((function(e,t){return new Date(t.ChatRoom.LastMessage.created_at)-new Date(e.ChatRoom.LastMessage.created_at)}));R([]),R(ve()(e)),M(!1)}));return function(){return e.apply(this,arguments)}}();Object(l.useEffect)((function(){var e=N.channel("public:UserChatRoom:UserID=eq."+A.currentUser.uid).on("postgres_changes",{event:"INSERT",schema:"public",table:"UserChatRoom",filter:"UserID=eq."+A.currentUser.uid},function(){var e=u()((function*(e){console.log("newChatRoom",e),E()}));return function(t){return e.apply(this,arguments)}}());return function(){N.removeChannel(e)}}),[A.currentUser.uid]),Object(l.useEffect)((function(){E()}),[]);return 1===(null==S?void 0:S.length)&&"b15f0db2-87f6-4358-874a-4297ee170240"===(null==(e=S[0])||null==(t=e.ChatRoom)?void 0:t.LastMessageID)||0===(null==S?void 0:S.length)?Object(w.jsx)(Ce.default,{contentContainerStyle:it.emptyChats,refreshControl:Object(w.jsx)(Se.default,{refreshing:P,onRefresh:E}),children:Object(w.jsxs)(j.default,{style:{color:"white"},children:["No chats yet \ud83d\ude05. Start a"," ",Object(w.jsx)(j.default,{onPress:function(){f.navigate("Search")},style:{textDecorationLine:"underline"},children:"new chat."})]})}):Object(w.jsxs)(g.default,{style:[it.root,{minHeight:o-1}],children:[Object(w.jsxs)(g.default,{style:[it.homeleft,{width:.3*n,height:o-15}],children:[Object(w.jsx)(qe,{}),Object(w.jsx)(we.default,{data:S,extraData:k,renderItem:function(e){var t=e.item;return Object(w.jsx)(Ee,{chat:t,onPress:function(e,t){return x({otherUser:e,chatRoomId:t})}})},onRefresh:E,refreshing:P})]}),y?Object(w.jsx)(g.default,{style:[it.chatRoom,{width:.7*n-30,height:o-15}],children:Object(w.jsx)(at,{otherUser:y.otherUser,chatRoomId:y.chatRoomId})}):Object(w.jsx)(g.default,{style:[it.noChatRoom,{width:.7*n-30,height:o-15}],children:Object(w.jsx)(j.default,{style:it.noChat,children:"Open a chat room and start a conversation !"})})]})},lt=o.default.create({root:{flex:1,backgroundColor:v.myColors.pbgc,alignItems:"center",padding:20},container:{width:"100%",borderColor:"white",borderWidth:1,borderRadius:10,marginVertical:20,padding:20,backgroundColor:v.myColors.sbgc},link:{fontWeight:"bold",paddingVertical:10,fontSize:15,color:"white",width:"100%",textAlign:"center",textDecorationLine:"underline",textDecorationColor:"white"},title:{fontSize:24,fontWeight:"bold",color:"white",margin:10},text:{width:"100%",color:"#707271",fontSize:12,marginVertical:10},btnContainer:{flexDirection:"row",alignItems:"center",justifyContent:"space-around"}}),ct=function(){Object(L.useRoute)();var e=Object(C.useForm)(),t=e.control,r=e.handleSubmit,n=((0,e.watch)("email"),Object(L.useNavigation)()),o=function(){var e=u()((function*(e){try{yield Object(E.sendPasswordResetEmail)(A,e.email),x.default.alert("Link sent","Check your email to reset your password"),n.navigate("SignIn",{email:e.email})}catch(t){x.default.alert("Oops",t.message)}}));return function(t){return e.apply(this,arguments)}}(),a=Object(p.default)(),i=(a.width,a.height,Object(l.useState)("")),s=h()(i,2),c=(s[0],s[1],Object(l.useState)("")),d=h()(c,2);d[0],d[1];return Object(w.jsxs)(g.default,{style:lt.root,children:[Object(w.jsx)(j.default,{style:lt.title,children:"Reset your password"}),Object(w.jsxs)(g.default,{style:lt.container,children:[Object(w.jsx)(R,{name:"email",placeholder:"Email",control:t,rules:{required:"Email is required"}}),Object(w.jsx)(M,{onPress:r(o),text:"Send"}),Object(w.jsx)(g.default,{style:lt.btnContainer,children:Object(w.jsx)(g.default,{children:Object(w.jsx)(M,{text:"Back to Sign in",onPress:function(){console.warn("Sign in"),n.navigate("SignIn")},type:"SECONDARY"})})})]})]})},dt=o.default.create({root:{flex:1,backgroundColor:v.myColors.pbgc,alignItems:"center",padding:20},container:{width:"100%",borderColor:"white",borderWidth:1,borderRadius:10,marginVertical:20,padding:20,backgroundColor:v.myColors.sbgc},link:{fontWeight:"bold",paddingVertical:10,fontSize:15,color:"white",width:"100%",textAlign:"center",textDecorationLine:"underline",textDecorationColor:"white"},title:{fontSize:24,fontWeight:"bold",color:"white",margin:10},text:{width:"100%",color:"#707271",fontSize:12,marginVertical:10},btnContainer:{flexDirection:"row",alignItems:"center",justifyContent:"space-around"}}),ut=function(){var e,t=Object(L.useRoute)(),r=Object(C.useForm)(),n=r.control,o=r.handleSubmit,a=r.watch,i=(null==t||null==(e=t.params)||e.email,a("password")),s=Object(L.useNavigation)(),c=function(){var e=u()((function*(e){}));return function(t){return e.apply(this,arguments)}}(),d=Object(p.default)(),f=(d.width,d.height,Object(l.useState)("")),m=h()(f,2),b=(m[0],m[1],Object(l.useState)("")),y=h()(b,2);y[0],y[1];return Object(w.jsxs)(g.default,{style:dt.root,children:[Object(w.jsx)(j.default,{style:dt.title,children:"Reset your password"}),Object(w.jsxs)(g.default,{style:dt.container,children:[Object(w.jsx)(R,{name:"code",placeholder:"Enter your confirmation code",control:n,rules:{required:"Confirmation code is required"}}),Object(w.jsx)(R,{name:"password",placeholder:"Enter your new password",control:n,rules:{required:"Password is required",minLength:{value:6,message:"Password must be at least 6 characters"}},secure:!0}),Object(w.jsx)(R,{name:"confirmPassword",placeholder:"Confirm new Password",control:n,rules:{required:"Passwords do not match",validate:function(e){return e===i||"Passwords do not match"}},secure:!0}),Object(w.jsx)(M,{onPress:o(c),text:"Submit"}),Object(w.jsx)(g.default,{style:dt.btnContainer,children:Object(w.jsx)(g.default,{children:Object(w.jsx)(M,{text:"Back to Sign in",onPress:function(){s.navigate("SignIn")},type:"SECONDARY"})})})]})]})},ft=r(522),ht=r(528),gt=o.default.create({root:{backgroundColor:v.myColors.pbgc,flex:1},imageContainer:{height:200,justifyContent:"center",alignItems:"center",marginVertical:10},image:{borderRadius:100,width:"50%",height:"90%"},container:{flexDirection:"row",marginHorizontal:10,marginVertical:5,paddingVertical:10},containerPressed:{flexDirection:"row",marginHorizontal:10,marginVertical:5,paddingVertical:10,backgroundColor:"#1e1e1e",borderRadius:10},content:{flex:1,height:"105%",borderBottomWidth:o.default.hairlineWidth,borderBottomColor:"grey"},icon1:{width:"14%",height:50,marginRight:10,textAlign:"center"},icon2:{width:"14%",marginRight:10,textAlign:"center"},row:{flexDirection:"row",marginBottom:5},name:{fontSize:16,color:v.myColors.secondaryText,flex:1},title:{color:v.myColors.secondaryText,fontSize:14},subTitle:{fontSize:16,color:"white"}}),mt=function(){var e=Object(l.useState)(null),t=h()(e,2),r=t[0],n=t[1],o=Object(l.useState)(null),a=h()(o,2),i=a[0],s=a[1],c=Object(l.useState)(null),d=h()(c,2),f=d[0],m=d[1],b=Object(l.useState)(null),y=h()(b,2),p=y[0],x=y[1],C=Object(l.useState)(!1),S=h()(C,2),R=S[0],P=S[1],M=Object(L.useNavigation)(),T=Object(l.useState)(!1),U=h()(T,2),k=(U[0],U[1],Object(l.useRef)(null)),z=function(){Object(E.signOut)(A)},B=function(){var e=u()((function*(){var e=A.currentUser,t=yield J(e.uid);n(t),s(t.name),x(t.image),m(t.status)}));return function(){return e.apply(this,arguments)}}();Object(l.useEffect)((function(){B()}),[]),Object(l.useEffect)((function(){M.setOptions({headerTitle:"Settings",headerTintColor:"white",headerStyle:{backgroundColor:v.myColors.pbgc,color:"white"},headerBackTitle:"Back",headerRight:function(){return Object(w.jsx)(w.Fragment,{children:Object(w.jsx)(j.default,{style:{color:"white",fontSize:20,fontWeight:"bold"},onPress:z,children:"Sign Out"})})}})}),[]);var q=function(){var e=u()((function*(e){console.log("image changed");var t=yield N.from("User").update({image:"https://notjustdev-dummy.s3.us-east-2.amazonaws.com/avatars/"+e+".jpg"}).eq("id",r.id).select(),n=t.data,o=t.error;console.log(n,o),B()}));return function(t){return e.apply(this,arguments)}}(),W=function(){var e=u()((function*(){if(f.length<3)return alert("Status must be atleast 3 characters long"),void m(r.status);yield N.from("User").update({status:f}).eq("id",r.id),B()}));return function(){return e.apply(this,arguments)}}(),V=function(){var e=u()((function*(){if(i.length<3)return alert("Name must be atleast 3 characters long"),void s(r.name);yield N.from("User").update({name:i}).eq("id",r.id),B()}));return function(){return e.apply(this,arguments)}}();return Object(w.jsxs)(g.default,{style:gt.root,children:[R?Object(w.jsx)(g.default,{style:{marginTop:10,height:"50%",marginBottom:10},children:Object(w.jsx)(we.default,{data:["1","2","3","4"],renderItem:function(e){var t=e.item;return Object(w.jsx)(I.default,{onPress:function(){P(!1),x("https://notjustdev-dummy.s3.us-east-2.amazonaws.com/avatars/"+t+".jpg"),q(t)},style:{padding:10,height:"80%"},children:Object(w.jsx)(Pe.default,{source:{uri:"https://notjustdev-dummy.s3.us-east-2.amazonaws.com/avatars/"+t+".jpg"},style:{borderRadius:100,width:150,height:150}})})},numColumns:2,columnWrapperStyle:{justifyContent:"space-around"}})}):Object(w.jsx)(I.default,{style:gt.imageContainer,onPress:function(){return P(!0)},children:Object(w.jsx)(Pe.default,{source:{uri:p},style:gt.image})}),Object(w.jsxs)(I.default,{style:function(e){return e.pressed?gt.containerPressed:gt.container},onPress:function(){var e;return null==(e=k.current)?void 0:e.focus()},children:[Object(w.jsx)(D.default,{style:gt.icon1,name:"user",size:24,color:v.myColors.secondaryText}),Object(w.jsxs)(g.default,{style:gt.content,children:[Object(w.jsx)(j.default,{style:gt.title,children:"Name"}),Object(w.jsx)(O.default,{style:gt.subTitle,ref:k,maxLength:20,onChangeText:function(e){return s(e)},onSubmitEditing:V,value:i}),Object(w.jsx)(j.default,{style:{color:v.myColors.secondaryText,marginTop:10,fontSize:12},children:"This is not your username or pin. This name will be visible to your chat contacts."})]}),Object(w.jsx)(ht.default,{style:gt.icon2,name:"pen",size:18,color:v.myColors.secondaryText})]}),Object(w.jsxs)(I.default,{style:function(e){return e.pressed?gt.containerPressed:gt.container},children:[Object(w.jsx)(ft.default,{style:gt.icon1,name:"info",size:24,color:v.myColors.secondaryText}),Object(w.jsxs)(g.default,{style:gt.content,children:[Object(w.jsx)(j.default,{style:gt.title,children:"About"}),Object(w.jsx)(O.default,{style:gt.subTitle,maxLength:30,onChangeText:function(e){return m(e)},onSubmitEditing:W,value:f})]}),Object(w.jsx)(ht.default,{style:gt.icon2,name:"pen",size:18,color:v.myColors.secondaryText})]})]})},bt=(o.default.create({header:{}}),function(){var e=Object(l.useState)(void 0),t=h()(e,2),r=t[0],n=t[1],o=function(){var e=u()((function*(){Object(E.onAuthStateChanged)(A,(function(e){e&&e.emailVerified?n(!0):n(!1)}))}));return function(){return e.apply(this,arguments)}}();if(Object(l.useEffect)((function(){o()}),[]),void 0===r)return Object(w.jsx)(g.default,{style:{flex:1,justifyContent:"center",alignItems:"center"},children:Object(w.jsx)(m.default,{})});var a=Object(y.default)();return Object(w.jsx)(b.default,{children:Object(w.jsx)(a.Navigator,{screenOptions:{headerShown:!0},children:r?Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(a.Screen,{name:"Home",component:st}),Object(w.jsx)(a.Screen,{name:"ChatRoom",component:at}),Object(w.jsx)(a.Screen,{name:"Search",component:Qe}),Object(w.jsx)(a.Screen,{name:"Settings",component:mt})]}):Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(a.Screen,{name:"SignIn",component:ge,options:{headerShown:!1}}),Object(w.jsx)(a.Screen,{name:"SignUp",component:je,options:{headerShown:!1}}),Object(w.jsx)(a.Screen,{name:"ConfirmEmail",component:xe,options:{headerShown:!1}}),Object(w.jsx)(a.Screen,{name:"ResetPassword",component:ct,options:{headerShown:!1}}),Object(w.jsx)(a.Screen,{name:"NewPassword",component:ut,options:{headerShown:!1}})]})})})}),yt=r(322),jt=o.default.create({root:{width:"100%",backgroundColor:v.myColors.pbgc}});t.default=function(){return c.a.useEffect((function(){s.default.ignoreLogs(["AsyncStorage has been extracted from react-native core and will be removed in a future release. It can now be installed and imported from '@react-native-async-storage/async-storage' instead of 'react-native'. See https://github.com/react-native-async-storage/async-storage"])}),[]),yt.setBackgroundColorAsync("black"),Object(w.jsx)(n.GestureHandlerRootView,{style:{backgroundColor:"red",alignContent:"center",justifyContent:"center",flexDirection:"row"},children:Object(w.jsxs)(a.default,{style:jt.root,children:[Object(w.jsx)(i.default,{barStyle:"light-content",backgroundColor:"black"}),Object(w.jsx)(bt,{})]})})}},332:function(e,t,r){e.exports=r(502)},427:function(e,t,r){e.exports=r.p+"static/media/WhoCares.335a7108.png"}},[[332,1,2]]]);
//# sourceMappingURL=app.ffc3be54.chunk.js.map